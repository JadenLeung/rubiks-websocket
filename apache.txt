<VirtualHost *:80>
    ServerName api.virtual-cube.net
    Redirect permanent / https://api.virtual-cube.net/
RewriteEngine on
RewriteCond %{SERVER_NAME} =api.virtual-cube.net
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

<VirtualHost *:443>
    ServerName api.virtual-cube.net

    # SSL Configuration
    SSLEngine on

    # Proxy Configuration
    ProxyPreserveHost On

    # Regular HTTP Proxy for general traffic
    ProxyPass / http://localhost:8433/
    ProxyPassReverse / http://localhost:8433/

    # For Node.js application (API)
    ProxyPass /node/ http://localhost:3000/
    ProxyPassReverse /node/ http://localhost:3000/

    # WebSocket Proxying (needed for socket.io)
    ProxyPass /socket.io/ ws://localhost:3000/socket.io/
    ProxyPassReverse /socket.io/ ws://localhost:3000/socket.io/
    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/api.virtual-cube.net/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/api.virtual-cube.net/privkey.pem
</VirtualHost>